Репозиторий для командного проекта Auth API (Authentication service backend).

Сервис предназначен для аутентификации пользователей в системе.
В сервисе реализованы API эндпоинты для аутентификации пользователя и система управления ролями.

## Краткое описание функционала:

### API для сайта и личного кабинета
- регистрация пользователя;
- вход пользователя в аккаунт (обмен логина и пароля на пару токенов: JWT-access токен и refresh токен);
- обновление access-токена;
- выход пользователя из аккаунта;
- изменение логина или пароля (с отправкой email вы познакомитесь в следующих модулях, поэтому пока ваш сервис должен позволять изменять личные данные без дополнительных подтверждений);
- получение пользователем своей истории входов в аккаунт/

### API для управления доступами:

- создание роли;
- удаление роли;
- изменение рол;
- просмотр всех ролей;
- назначить пользователю роль;
- отобрать у пользователя роль;
- метод для проверки наличия прав у пользователя.

## Документация
- auth-service/docs/openapi_auth_api_doc.yaml - проектная документация по REST API, можно открыть в https://editor-next.swagger.io/
- auth-service/docs/auth_service.jpeg - схема сервиса

## Запуск prod версии сервиса

1. Файл в корне проекта `.env.template` копируем в `.env`

2. `make prod-up` - запускает все сервисы в докер контейнерах.

После того, как все сервисы стартовали: 
- API доступен по адресу http://127.0.0.1/api/
- Спецификация http://127.0.0.1/api/openapi

Попасть внутрь контейнера с базой (пригодится для выдачи прав суперпользователя или чтобы узнать id юзера для запросов):

`docker exec -it auth_module_group_repo-auth_postgres-1 psql -h 127.0.0.1 -U app -d auth_database`

Выдать права суперпользователя - в табличке `users` обновляем любого существующего пользователя:

`update users set is_superuser=true where email='admin@mail.com';`



## Запуск тестов в контейнере

1. Файл `.env` (создали его на этапе запуска prod версии) копируем в `auth-service/src/tests/functional/test.env`

2. `make tests-up`

## Локальный запуск сервиса

Для локального запуска необходимо:

1. Поставить пакеты из `/auth-service/requirements.txt`
2. Файл `.env.template` скопировать в `auth-service/src/core/.env`;
3. Закомментировать `API_HOST`, `PG_HOST` и `REDIS_HOST` переменные в файле `.env`;
4. Находясь в корне проекта, запустить `make local-up`.
5. После того как контейнеры стартовали, запустить `auth-service/main.py`.

Спецификация будет доступна по адресу http://0.0.0.0:8000/api/openapi

## Локальный запуск тестов

Для локального запуска тестов необходимо:

1. Запустить сервис локально (на шаге `4` запускаем `make tests-local-up`);
2. Файл `.env` копируем в `auth-service/src/tests/functional/test.env`;
3. Закомментировать `API_HOST`, `PG_HOST` и `REDIS_HOST` переменные в файле `test.env`;
4. Из папки `/src/tests/functional/` запустить `pytest -v -s -W ignore::DeprecationWarning`.


